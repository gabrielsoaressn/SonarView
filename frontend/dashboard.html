<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aurora View - Dashboard de Dívida Técnica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
</head>
<body class="bg-gray-50 font-sans antialiased">
    <div id="app">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-6">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">Aurora View</h1>
                        <p class="text-sm text-gray-500">Dashboard de Monitoramento de Dívida Técnica</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-sm text-gray-500" id="last-update">
                            Última atualização: --:--:--
                        </div>
                        <button onclick="fetchData()" class="bg-blue-600 text-white px-3 py-2 rounded text-sm hover:bg-blue-700 transition-colors flex items-center">
                            <i class="fas fa-sync mr-2"></i>
                            Atualizar
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Quality Gate -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center">
                        <h2 class="text-xl font-semibold text-gray-900 mr-4">Quality Gate</h2>
                        <div id="quality-gate-status" class="flex items-center px-3 py-1 rounded-full border">
                            <i class="fas fa-spinner fa-spin mr-2"></i>
                            <span class="font-semibold">Carregando...</span>
                        </div>
                    </div>
                    <div class="text-sm text-gray-500" id="project-info">
                        Projeto: Carregando...
                    </div>
                </div>

                <!-- Condições do Quality Gate -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="quality-conditions">
                    <!-- Será preenchido dinamicamente -->
                </div>
            </div>

            <!-- Navegação por Abas -->
            <div class="border-b border-gray-200 mb-6">
                <nav class="-mb-px flex space-x-8">
                    <button onclick="switchTab('overview')" class="tab-button py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 border-blue-500 text-blue-600" data-tab="overview">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Visão Geral</span>
                    </button>
                    <button onclick="switchTab('reliability')" class="tab-button py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="reliability">
                        <i class="fas fa-shield-alt"></i>
                        <span>Confiabilidade</span>
                    </button>
                    <button onclick="switchTab('security')" class="tab-button py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="security">
                        <i class="fas fa-lock"></i>
                        <span>Segurança</span>
                    </button>
                    <button onclick="switchTab('maintainability')" class="tab-button py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="maintainability">
                        <i class="fas fa-tools"></i>
                        <span>Manutenibilidade</span>
                    </button>
                </nav>
            </div>

            <!-- Conteúdo das Abas -->
            <div id="tab-content">
                <!-- Overview Tab -->
                <div id="overview-tab" class="tab-content space-y-6">
                    <!-- Métricas Principais -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="main-metrics">
                        <!-- Será preenchido dinamicamente -->
                    </div>

                    <!-- Gráficos de Tendência -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-lg font-semibold mb-4">Tendência da Dívida Técnica</h3>
                            <div class="relative h-64">
                                <canvas id="debt-trend-chart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-lg font-semibold mb-4">Qualidade do Código Novo</h3>
                            <div class="relative h-64">
                                <canvas id="new-code-chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Resumo por Categoria -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="category-summary">
                        <!-- Será preenchido dinamicamente -->
                    </div>
                </div>

                <!-- Reliability Tab -->
                <div id="reliability-tab" class="tab-content space-y-6 hidden">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="reliability-metrics">
                        <!-- Será preenchido dinamicamente -->
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold mb-4">Tendência de Bugs</h3>
                        <div class="relative h-64">
                            <canvas id="bugs-trend-chart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold mb-4">Distribuição de Bugs por Severidade</h3>
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-4" id="bugs-severity">
                            <!-- Será preenchido dinamicamente -->
                        </div>
                    </div>
                </div>

                <!-- Security Tab -->
                <div id="security-tab" class="tab-content space-y-6 hidden">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="security-metrics">
                        <!-- Será preenchido dinamicamente -->
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold mb-4">Tendência de Vulnerabilidades</h3>
                        <div class="relative h-64">
                            <canvas id="security-trend-chart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold mb-4">Análise de Risco</h3>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6" id="risk-analysis">
                            <!-- Será preenchido dinamicamente -->
                        </div>
                    </div>
                </div>

                <!-- Maintainability Tab -->
                <div id="maintainability-tab" class="tab-content space-y-6 hidden">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4" id="maintainability-metrics">
                        <!-- Será preenchido dinamicamente -->
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-lg font-semibold mb-4">Tendência de Code Smells</h3>
                            <div class="relative h-64">
                                <canvas id="smells-trend-chart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-lg font-semibold mb-4">Taxa de Dívida Técnica</h3>
                            <div class="relative h-64">
                                <canvas id="debt-ratio-chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-lg font-semibold mb-4">Análise da Dívida Técnica</h3>
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6" id="debt-analysis">
                            <!-- Será preenchido dinamicamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-8 rounded-lg shadow-xl max-w-md text-center">
                <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"></div>
                <h2 class="text-xl font-semibold text-gray-700 mb-2">Carregando Aurora View...</h2>
                <p class="text-gray-500">Coletando métricas de dívida técnica</p>
            </div>
        </div>

        <!-- Error Modal -->
        <div id="error-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white p-8 rounded-lg shadow-xl max-w-md text-center">
                <div class="text-red-500 text-5xl mb-4">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h2 class="text-xl font-semibold text-gray-800 mb-2">Erro ao Carregar Dados</h2>
                <p class="text-gray-600 mb-4" id="error-message">Falha ao carregar dados</p>
                <button onclick="fetchData()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors">
                    Tentar Novamente
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentData = null;
        let currentTab = 'overview';
        let charts = {};

        // Mock data para demonstração (substitua pela sua API)
        const mockData = {
            projectKey: 'aurora-view-demo',
            overallRating: 'B',
            technicalDebtMinutes: 480,
            size: {
                linesOfCode: 15420,
                complexity: 156
            },
            coverage: {
                overall: 78.5,
                new: 85.2
            },
            reliability: {
                rating: 'A',
                bugs: 2,
                remediationEffort: 120
            },
            security: {
                rating: 'B',
                vulnerabilities: 1,
                remediationEffort: 60
            },
            maintainability: {
                rating: 'B',
                codeSmells: 45,
                debtRatio: 8.5
            },
            duplication: {
                density: 3.2
            },
            newCode: {
                bugs: 0,
                vulnerabilities: 0,
                codeSmells: 3
            }
        };

        async function fetchData() {
            try {
                showLoading();
                
                // Tente buscar da API real primeiro
                try {
                    const response = await fetch('/api/metrics/latest');
                    if (response.ok) {
                        currentData = await response.json();
                    } else {
                        throw new Error('API não disponível');
                    }
                } catch (apiError) {
                    console.log('API não disponível, usando dados mock:', apiError);
                    // Simulate API delay
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    currentData = mockData;
                }

                updateDashboard();
                hideLoading();
                updateLastUpdate();

            } catch (error) {
                console.error('Erro ao buscar dados:', error);
                showError(error.message);
            }
        }

        function showLoading() {
            document.getElementById('loading-overlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading-overlay').classList.add('hidden');
        }

        function showError(message) {
            document.getElementById('error-message').textContent = message;
            document.getElementById('error-modal').classList.remove('hidden');
            hideLoading();
        }

        function updateLastUpdate() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-BR');
            document.getElementById('last-update').textContent = `Última atualização: ${timeString}`;
        }

        function updateDashboard() {
            if (!currentData) return;

            updateQualityGate();
            updateMainMetrics();
            updateCategorySummary();
            updateCharts();
        }

        function updateQualityGate() {
            const status = getOverallStatus();
            const statusElement = document.getElementById('quality-gate-status');
            
            statusElement.className = `flex items-center px-3 py-1 rounded-full border ${status.class}`;
            statusElement.innerHTML = `
                <i class="${status.icon} mr-2"></i>
                <span class="font-semibold capitalize">${status.text}</span>
            `;

            document.getElementById('project-info').textContent = `Projeto: ${currentData.projectKey}`;

            // Update conditions
            let coverageStatus;
            if (currentData.coverage.overall >= 80) {
                coverageStatus = 'passed';
            } else if (currentData.coverage.overall >= 60) {
                coverageStatus = 'warning';
            } else {
                coverageStatus = 'failed';
            }

            const conditions = [
                {
                    name: 'Confiabilidade',
                    status: currentData.reliability.rating <= 'B' ? 'passed' : 'failed',
                    value: currentData.reliability.rating,
                    detail: `${currentData.reliability.bugs} bugs`
                },
                {
                    name: 'Segurança',
                    status: currentData.security.rating <= 'B' ? 'passed' : 'failed',
                    value: currentData.security.rating,
                    detail: `${currentData.security.vulnerabilities} vulnerabilidades`
                },
                {
                    name: 'Manutenibilidade',
                    status: currentData.maintainability.rating <= 'B' ? 'passed' : 'failed',
                    value: currentData.maintainability.rating,
                    detail: `${currentData.maintainability.debtRatio.toFixed(1)}% taxa de dívida`
                },
                {
                    name: 'Cobertura',
                    status: coverageStatus,
                    value: `${currentData.coverage.overall.toFixed(1)}%`,
                    detail: 'cobertura de testes'
                }
            ];

            const conditionsHTML = conditions.map(condition => `
                <div class="border rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-medium text-gray-700">${condition.name}</span>
                        <i class="${getStatusIcon(condition.status)} ${getStatusColorText(condition.status)}"></i>
                    </div>
                    <div class="text-2xl font-bold text-gray-900 mb-1">
                        ${condition.value}
                    </div>
                    <div class="text-sm text-gray-500">
                        ${condition.detail}
                    </div>
                </div>
            `).join('');

            document.getElementById('quality-conditions').innerHTML = conditionsHTML;
        }

        function updateMainMetrics() {
            const metrics = [
                {
                    title: 'Classificação Geral',
                    value: currentData.overallRating,
                    icon: 'fas fa-star',
                    class: getRatingColorClass(currentData.overallRating)
                },
                {
                    title: 'Dívida Técnica',
                    value: `${Math.round(currentData.technicalDebtMinutes / 60)}h`,
                    icon: 'fas fa-clock',
                    class: 'text-orange-600 bg-orange-50 border-orange-200'
                },
                {
                    title: 'Linhas de Código',
                    value: currentData.size.linesOfCode.toLocaleString('pt-BR'),
                    icon: 'fas fa-code',
                    class: 'text-blue-600 bg-blue-50 border-blue-200'
                },
                {
                    title: 'Cobertura de Testes',
                    value: `${currentData.coverage.overall.toFixed(1)}%`,
                    icon: 'fas fa-vial',
                    class: getCoverageColorClass(currentData.coverage.overall)
                }
            ];

            const metricsHTML = metrics.map(metric => `
                <div class="p-4 rounded-lg border ${metric.class}">
                    <div class="flex items-center">
                        <i class="${metric.icon} text-lg mr-3"></i>
                        <div>
                            <p class="text-sm font-medium opacity-75">${metric.title}</p>
                            <p class="text-2xl font-bold">${metric.value}</p>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('main-metrics').innerHTML = metricsHTML;
        }

        function updateCategorySummary() {
            const categories = [
                {
                    name: 'Confiabilidade',
                    icon: 'fas fa-shield-alt text-blue-600',
                    items: [
                        { label: 'Classificação', value: currentData.reliability.rating },
                        { label: 'Bugs', value: currentData.reliability.bugs, highlight: currentData.reliability.bugs > 0 },
                        { label: 'Esforço de Correção', value: `${Math.round(currentData.reliability.remediationEffort / 60)}h` }
                    ]
                },
                {
                    name: 'Segurança',
                    icon: 'fas fa-lock text-orange-600',
                    items: [
                        { label: 'Classificação', value: currentData.security.rating },
                        { label: 'Vulnerabilidades', value: currentData.security.vulnerabilities, highlight: currentData.security.vulnerabilities > 0 },
                        { label: 'Esforço de Correção', value: `${Math.round(currentData.security.remediationEffort / 60)}h` }
                    ]
                },
                {
                    name: 'Manutenibilidade',
                    icon: 'fas fa-tools text-purple-600',
                    items: [
                        { label: 'Classificação', value: currentData.maintainability.rating },
                        { label: 'Code Smells', value: currentData.maintainability.codeSmells, highlight: currentData.maintainability.codeSmells > 10 },
                        { label: 'Taxa de Dívida', value: `${currentData.maintainability.debtRatio.toFixed(1)}%`, highlight: currentData.maintainability.debtRatio > 5 }
                    ]
                }
            ];

            const categoriesHTML = categories.map(category => `
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="${category.icon} mr-2"></i>
                        ${category.name}
                    </h3>
                    <div class="space-y-3">
                        ${category.items.map(item => `
                            <div class="flex justify-between">
                                <span>${item.label}:</span>
                                <span class="${item.highlight ? 'text-red-600 font-semibold' : 'font-semibold'}">${item.value}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');

            document.getElementById('category-summary').innerHTML = categoriesHTML;
        }

        function updateCharts() {
            // Destroy existing charts
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });
            charts = {};

            // Mock historical data for trends
            const mockHistory = generateMockHistory();

            // Create trend charts
            createDebtTrendChart(mockHistory);
            createNewCodeChart();
            createBugsTrendChart(mockHistory);
            createSecurityTrendChart(mockHistory);
            createSmellsTrendChart(mockHistory);
            createDebtRatioChart(mockHistory);
        }

        function generateMockHistory() {
            const history = [];
            const now = new Date();
            for (let i = 23; i >= 0; i--) {
                const timestamp = new Date(now.getTime() - i * 60 * 60 * 1000);
                history.push({
                    timestamp: timestamp.toISOString(),
                    technicalDebtMinutes: currentData.technicalDebtMinutes + (Math.random() - 0.5) * 100,
                    reliability: { bugs: Math.max(0, currentData.reliability.bugs + Math.floor((Math.random() - 0.5) * 4)) },
                    security: { vulnerabilities: Math.max(0, currentData.security.vulnerabilities + Math.floor((Math.random() - 0.5) * 2)) },
                    maintainability: { 
                        codeSmells: Math.max(0, currentData.maintainability.codeSmells + Math.floor((Math.random() - 0.5) * 10)),
                        debtRatio: Math.max(0, currentData.maintainability.debtRatio + (Math.random() - 0.5) * 2)
                    }
                });
            }
            return history;
        }

        function createDebtTrendChart(history) {
            const ctx = document.getElementById('debt-trend-chart').getContext('2d');
            charts.debtTrend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: history.map(h => new Date(h.timestamp).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })),
                    datasets: [{
                        label: 'Dívida Técnica (horas)',
                        data: history.map(h => Math.round(h.technicalDebtMinutes / 60)),
                        borderColor: '#EF4444',
                        backgroundColor: '#EF444420',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: getChartOptions('Dívida Técnica ao Longo do Tempo')
            });
        }

        function createNewCodeChart() {
            const ctx = document.getElementById('new-code-chart').getContext('2d');
            charts.newCode = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Bugs', 'Vulnerabilidades', 'Code Smells'],
                    datasets: [{
                        label: 'Problemas no Código Novo',
                        data: [currentData.newCode.bugs, currentData.newCode.vulnerabilities, currentData.newCode.codeSmells],
                        backgroundColor: ['#EF4444', '#F59E0B', '#EAB308'],
                        borderWidth: 1
                    }]
                },
                options: getChartOptions('Qualidade do Código Novo')
            });
        }

        function createBugsTrendChart(history) {
            const ctx = document.getElementById('bugs-trend-chart');
            if (ctx) {
                charts.bugs = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: history.map(h => new Date(h.timestamp).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })),
                        datasets: [{
                            label: 'Bugs',
                            data: history.map(h => h.reliability.bugs),
                            borderColor: '#DC2626',
                            backgroundColor: '#DC262620',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: getChartOptions('Tendência de Bugs')
                });
            }
        }

        function createSecurityTrendChart(history) {
            const ctx = document.getElementById('security-trend-chart');
            if (ctx) {
                charts.security = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: history.map(h => new Date(h.timestamp).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })),
                        datasets: [{
                            label: 'Vulnerabilidades',
                            data: history.map(h => h.security.vulnerabilities),
                            borderColor: '#F59E0B',
                            backgroundColor: '#F59E0B20',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: getChartOptions('Tendência de Vulnerabilidades')
                });
            }
        }

        function createSmellsTrendChart(history) {
            const ctx = document.getElementById('smells-trend-chart');
            if (ctx) {
                charts.smells = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: history.map(h => new Date(h.timestamp).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })),
                        datasets: [{
                            label: 'Code Smells',
                            data: history.map(h => h.maintainability.codeSmells),
                            borderColor: '#8B5CF6',
                            backgroundColor: '#8B5CF620',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: getChartOptions('Tendência de Code Smells')
                });
            }
        }

        function createDebtRatioChart(history) {
            const ctx = document.getElementById('debt-ratio-chart');
            if (ctx) {
                charts.debtRatio = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: history.map(h => new Date(h.timestamp).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })),
                        datasets: [{
                            label: 'Taxa de Dívida (%)',
                            data: history.map(h => h.maintainability.debtRatio),                            borderColor: '#F97316',
                            backgroundColor: '#F9731620',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: getChartOptions('Taxa de Dívida Técnica')
                });
            }
        }

        // Helpers
        function getChartOptions(title) {
            return {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top' },
                    title: { display: true, text: title }
                },
                scales: {
                    x: { ticks: { maxRotation: 45, minRotation: 0 } },
                    y: { beginAtZero: true }
                }
            };
        }

        function getOverallStatus() {
            if (currentData.overallRating === 'A' || currentData.overallRating === 'B') {
                return { text: 'Aprovado', icon: 'fas fa-check-circle text-green-600', class: 'border-green-300 bg-green-50 text-green-700' };
            }
            if (currentData.overallRating === 'C') {
                return { text: 'Atenção', icon: 'fas fa-exclamation-circle text-yellow-600', class: 'border-yellow-300 bg-yellow-50 text-yellow-700' };
            }
            return { text: 'Reprovado', icon: 'fas fa-times-circle text-red-600', class: 'border-red-300 bg-red-50 text-red-700' };
        }

        function getStatusIcon(status) {
            if (status === 'passed') return 'fas fa-check-circle text-green-500';
            if (status === 'warning') return 'fas fa-exclamation-circle text-yellow-500';
            return 'fas fa-times-circle text-red-500';
        }

        function getStatusColorText(status) {
            if (status === 'passed') return 'text-green-600';
            if (status === 'warning') return 'text-yellow-600';
            return 'text-red-600';
        }

        function getRatingColorClass(rating) {
            switch (rating) {
                case 'A': return 'text-green-600 bg-green-50 border-green-200';
                case 'B': return 'text-blue-600 bg-blue-50 border-blue-200';
                case 'C': return 'text-yellow-600 bg-yellow-50 border-yellow-200';
                default:  return 'text-red-600 bg-red-50 border-red-200';
            }
        }

        function getCoverageColorClass(value) {
            if (value >= 80) return 'text-green-600 bg-green-50 border-green-200';
            if (value >= 60) return 'text-yellow-600 bg-yellow-50 border-yellow-200';
            return 'text-red-600 bg-red-50 border-red-200';
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-button').forEach(btn => {
                const isActive = btn.dataset.tab === tab;
                btn.classList.toggle('border-blue-500', isActive);
                btn.classList.toggle('text-blue-600', isActive);
                btn.classList.toggle('border-transparent', !isActive);
                btn.classList.toggle('text-gray-500', !isActive);
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${tab}-tab`).classList.remove('hidden');
        }

        // Inicializar
        window.addEventListener('DOMContentLoaded', () => {
            fetchData();
        });
    </script>
</body>
</html>
